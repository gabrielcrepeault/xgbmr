## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
library(xgbmr)
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
black_box_explain()
devtools::install_github(repo = 'gabrielcrepeault/xgbmr')
library(xgbmr)
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
b
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
library(xgbmr)
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
knitr::opts_chunk$set(echo = TRUE)
library(xgbmr)
library(xgbmr)
library(xgboost)
library(iml)
data("simulated-individual-claims")
dt <- data("simulated-individual-claims")
dt <- SimulatedIndClaims
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(tidyverse)
## transformer un rmd en vignette pour le package
library(devtools)
###################################################
### code chunk number 2: import-models
###################################################
# fit_a <- read_rds(file.path('..', 'R', 'models', 'modele_a', 'modele_a.rda'))
# fit_b <- read_rds(file.path('..', 'R', 'models', 'modele_b', 'modele_b.rda'))
# fit_c <- read_rds(file.path('..', 'R', 'models', 'modele_c', 'modele_c.rda'))
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
fit_a <- read_rds(file.path('..', 'R', 'models', 'modele_a_long', 'modele_a_long.rda'))
fit_b <- read_rds(file.path('..', 'R', 'models', 'modele_b_long', 'modele_b_long.rda'))
fit_c <- read_rds(file.path('..', 'R', 'models', 'modele_c_long', 'modele_c_long.rda'))
## Source file to update pkg_down
## Cmd+Shift+B : Build le package
## CMd+Shift+D : Build la documentation avec Roxygen
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
setwd('../')
## transformer un rmd en vignette pour le package
use_data(fit_a)
## transformer un rmd en vignette pour le package
use_data(fit_a, fit_b, fit_c)
use_data(fit_b)
use_data(fit_c)
library(xgbmr)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(xgbmr)
library(tidyverse)
library(xgboost)
library(mlr)
library(iml)
library(xtable) # pour des fins de présentation
dt <- SimulatedIndClaims
dt <- SimulatedIndClaims
dat <- dt %>% censoreDataset(evalYr = 2005)
dat %>%
select(ClNr, AY, starts_with('Pay'), real_ultimate) %>%
sample_n(5) %>%
knitr::kable()
set.seed(20191023)
index <- makeResampleInstance(
desc = makeResampleDesc('Holdout', stratify.cols = 'AY', split = 0.70),
# il faut absolument donner une tâche et un target bidon
task = makeRegrTask(data = dt, target = 'Pay00')
)
traindt <- dat[index$train.inds[[1]],]
testdt <- dat[index$test.inds[[1]],]
mack_bs_tri <- traindt %>%
getAggrTriangle() %>%
ChainLadder::BootChainLadder(R = 1000)
ldf_bs <- mack_bs_tri$simClaims %>%
apply(3, function(triangle){
triangle %>% incr2cum() %>% as.triangle() %>% getLDF()
}) %>% t() %>% apply(2, quantile, probs = 0.8)
data.frame(LDF = ldf_bs) %>% t() %>% knitr::kable()
train_a <- traindt %>%
widetolong() %>%
filter(complete.cases(.)) %>% # garder les années connues
filter(!(Open == 1 & Paid == 0)) %>% # enlever masse à 0
select(-AY, -TotalPaid, -Pay, -still, -max_dev_yr) %>%
rename(Ultimate = real_ultimate) %>%
# Arranger le dataset final pour le modèle A
select(ClNr:RepDel, devYear, Paid, Open, Ultimate) %>%
as_tibble()
train_b <- traindt %>%
widetolong() %>%
filter(complete.cases(.)) %>%
mutate(Ultimate = TotalPaid) %>%
filter(!(Open == 1 & Paid == 0)) %>% # enlever masse à 0
filter(Open == 0) %>%
select(-AY, -TotalPaid, -Pay, -still, -max_dev_yr, -real_ultimate) %>%
as_tibble()
train_c <- traindt %>%
widetolong() %>%
filter(complete.cases(.)) %>% # garder les années connues
mutate(Ultimate = case_when(
still == 1 ~ TotalPaid * ldf_bs[max_dev_yr + 1],
TRUE ~ TotalPaid)) %>%
filter(!(Open == 1 & Paid == 0)) %>% # enlever masse à 0
select(-AY, -TotalPaid, -Pay, -still, -max_dev_yr, -real_ultimate) %>%
as_tibble() # pour enlever le tag grouped df
test <- testdt %>%
widetolong() %>%
filter(complete.cases(.)) %>% # garder les années connues
rename(Ultimate = real_ultimate) %>%
# Arranger le dataset final pour le modèle A
select(ClNr:RepDel, devYear, Paid, Open, Ultimate) %>%
as_tibble()
fit_a
fit_a$learner$par.vals  %>% data.frame(Modèle = 'A', .) %>%
bind_rows(fit_b$learner$par.vals  %>% data.frame(Modèle = 'B', .),
fit_c$learner$par.vals  %>% data.frame(Modèle = 'C', .)) %>%
knitr::kable()
## Prédictions bootstrap
# bs_pred_a <- read_csv('../R/models/modele_a/pred/boostrap50.csv')
# bs_pred_b <- read_csv('../R/models/modele_b/pred/boostrap50.csv')
# bs_pred_c <- read_csv('../R/models/modele_c/pred/boostrap50.csv')
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
bs_pred_a <- read_csv('../R/models/modele_a_long/pred/boostrap20.csv')
bs_pred_b <- read_csv('../R/models/modele_b_long/pred/boostrap20.csv')
bs_pred_c <- read_csv('../R/models/modele_c_long/pred/boostrap20.csv')
use_data(bs_pred_a)
use_data(bs_pred_b)
use_data(bs_pred_c)
## Source file to update pkg_down
## Cmd+Shift+B : Build le package
## CMd+Shift+D : Build la documentation avec Roxygen
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
setwd('../')
use_data(bs_pred_a)
use_data(bs_pred_b)
use_data(bs_pred_c)
bs_pred_a
getwd()
use_data(bs_pred_a)
bs_pred_a <- read_csv('../R/models/modele_a_long/pred/boostrap20.csv')
## Prédictions bootstrap
# bs_pred_a <- read_csv('../R/models/modele_a/pred/boostrap50.csv')
# bs_pred_b <- read_csv('../R/models/modele_b/pred/boostrap50.csv')
# bs_pred_c <- read_csv('../R/models/modele_c/pred/boostrap50.csv')
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
bs_pred_a <- read_csv('../R/models/modele_a_long/pred/boostrap20.csv')
bs_pred_b <- read_csv('../R/models/modele_b_long/pred/boostrap20.csv')
bs_pred_c <- read_csv('../R/models/modele_c_long/pred/boostrap20.csv')
## Source file to update pkg_down
## Cmd+Shift+B : Build le package
## CMd+Shift+D : Build la documentation avec Roxygen
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
setwd('../')
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## transformer un rmd en vignette pour le package
use_data(fit_a)
use_data(fit_b)
use_data(fit_c)
setwd('../')
getwd()
## Source file to update pkg_down
## Cmd+Shift+B : Build le package
## CMd+Shift+D : Build la documentation avec Roxygen
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
getwd()
setwd('../')
## transformer un rmd en vignette pour le package
use_data(fit_a)
library(xgbmr)
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
## Mettre à jour le site web pkgdown ####
pkgdown::build_site()
